# –ê–π–ú–æ–Ω–µ—Ç—á–∏–∫

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –ª–æ—Ç—ã –Ω–∞ coins.ay.by, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

## –ß—Ç–æ —É–º–µ–µ—Ç

- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ñ–æ—Ç–æ, —Ü–µ–Ω–æ–π –∏ —Å—Å—ã–ª–∫–æ–π.
- –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ SQLite (`data/items.db`), —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞–º–∏ –ø—Ä—è–º–æ –∏–∑ —á–∞—Ç–∞ (`/tracking`).
- –î–∞—ë—Ç –ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫: –º–µ–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–æ–≤ (`/settings`).
- –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ `logs/bot.log` –∏ —à–ª—ë—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Python 3.11+)

```bash
git clone <url>
cd LotSearch
python -m venv venv
```


```bash
pip install -r requirements.txt
```

–°–æ–∑–¥–∞–π—Ç–µ `.env` –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```bash
copy .env.example .env   # Windows
cp .env.example .env     # Linux/macOS
```

```env
BOT_TOKEN=xxx
ADMIN_CHAT_IDS=123456789
CHECK_INTERVAL_MINUTES=60
MONITOR_URLS=https://coins.ay.by/...
```

`MONITOR_URLS` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Å–ø–∏—Å–æ–∫: –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –ª—É—á—à–µ —á–µ—Ä–µ–∑ `/tracking`.

## –ó–∞–ø—É—Å–∫

- `python main.py` ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ.
- `docker compose up --build` ‚Äî –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (–º–∞–ø–ø–∏—Ç `./data` –∏ `./logs`).

## –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π.
- `/status` ‚Äî —Ç–µ–∫—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∞–¥–º–∏–Ω—ã.
- `/tracking` ‚Äî –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞–º–∏ –∏ –ø—Ä–µ–≤—å—é.
- `/settings` ‚Äî –ø–∞–Ω–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.
- `/resend` ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –º–æ–Ω–µ—Ç –∏–∑ –ª–æ–≥–æ–≤ (—Å–º. —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ).
- `/help` ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞.

## –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –º–æ–Ω–µ—Ç

–ï—Å–ª–∏ –ø–æ –∫–∞–∫–∏–º-—Ç–æ –ø—Ä–∏—á–∏–Ω–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –º–æ–Ω–µ—Ç–∞—Ö –±—ã–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω—ã (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏ —Å–µ—Ç–∏, –æ—à–∏–±–∫–∏ DNS –∏ —Ç.–¥.), –∏—Ö –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `/resend`.

### –ö–∞–∫ –Ω–∞–π—Ç–∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –≤ –ª–æ–≥–∞—Ö:

```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –º–æ–Ω–µ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö retry
sudo grep -i "Retrying (Retry(total=0" logs.txt | grep -oP '/lot/[^"]+\.html' | sort -u

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤—Å–µ –º–æ–Ω–µ—Ç—ã —Å –ª—é–±—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sudo grep -i "Retrying.*after connection broken" logs.txt | grep -oP '/lot/[^"]+\.html' | sort -u

# –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ—Ç–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã —Å /resend:
(echo "/resend" && sudo grep -i "Retrying (Retry(total=0" logs.txt | grep -oP '/lot/[^"]+\.html' | sort -u)
```

**–í–∞–∂–Ω–æ:** –ö–æ–º–∞–Ω–¥—ã grep –≤—ã—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç —Ç–æ–ª—å–∫–æ URL –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤. –ö–∞–∂–¥–∞—è –º–æ–Ω–µ—Ç–∞ –±—É–¥–µ—Ç –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ.

### –§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã:

```
/resend
/lot/1-rubl-1921-ngc-ms-62-5036858316.html
/lot/1-rubl-1924-g-korotkaya-ost-k-2-5037786103.html
/lot/1-rubl-1924-god-serebro-5039126253.html
...
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞:

- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞–∂–¥—É—é –º–æ–Ω–µ—Ç—É —Å —Å–∞–π—Ç–∞
- ‚úÖ –ü–∞—Ä—Å–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω—É, –≥–∞–ª–µ—Ä–µ—é —Ñ–æ—Ç–æ)
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –ø–æ–º–µ—Ç–∫–æ–π "üîÑ –ü—Ä–æ–ø—É—â–µ–Ω–Ω–∞—è –º–æ–Ω–µ—Ç–∞"
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –º–æ–Ω–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ
- üìä –í—ã–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

### –ü—Ä–∏–º–µ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

```
‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ!

üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 35
‚è≠Ô∏è –£–∂–µ –±—ã–ª–∏: 5
‚ùå –û—à–∏–±–æ–∫: 3
üìä –í—Å–µ–≥–æ: 43
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ö–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º. –ú–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ –º–æ–Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è rate limits Telegram API.

## –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º —Å —Ç–µ–≥–æ–º @imprfctone –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

### üö® –¢–∏–ø—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤:

1. **–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** (–±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É)
   - –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–Ω–µ—Ç —Å —Å–∞–π—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ

2. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ URL**
   - –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–æ–º –∏–ª–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

3. **–û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–π –ø–æ—Å–ª–µ –≤—Å–µ—Ö retry**
   - DNS —Å–±–æ–∏, —Ç–∞–π–º–∞—É—Ç—ã –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –ú–æ–Ω–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –±–µ–∑ –ø–æ–ª–Ω—ã—Ö –≥–∞–ª–µ—Ä–µ–π
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ 5 –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–æ–Ω–µ—Ç + –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

4. **–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –º–æ–Ω–µ—Ç–µ**
   - –ü—Ä–æ–±–ª–µ–º—ã —Å Telegram API
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
   - –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ retry:

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –Ω–µ—É–¥–∞—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
- `REQUEST_MAX_RETRIES=3` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `REQUEST_BACKOFF_FACTOR=0.5` (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)
- Retry –Ω–∞ —Å—Ç–∞—Ç—É—Å—ã: 429, 500, 502, 503, 504
- Retry –Ω–∞ connection errors –∏ DNS failures

### ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏–∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏:

- **–ú–æ–Ω–µ—Ç—ã –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è**: –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–π –º–æ–Ω–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤—Å–µ–≥–¥–∞**: –≤ —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ –±–µ–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ**: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å—Ä–∞–∑—É –ø—Ä–∏—Ö–æ–¥—è—Ç —Å —Ç–µ–≥–æ–º
- **–ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `logs/bot.log`

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: `BOT_TOKEN`, `ADMIN_CHAT_IDS`, `CHECK_INTERVAL_MINUTES` (–º–∏–Ω—É—Ç—ã), `MONITOR_URLS` (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é).
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ: `DB_PATH` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `data/items.db`), `LOG_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `logs`), `REQUEST_TIMEOUT`, `REQUEST_MAX_RETRIES`, `REQUEST_BACKOFF_FACTOR`.

## –¢–µ—Å—Ç—ã

- `pytest` ‚Äî —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã.
- `pytest --cov` ‚Äî –ø–æ–∫—Ä—ã—Ç–∏–µ.
- `pytest -m integration` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ç–∏–≤ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ (–Ω—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç).

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
