# АйМонетчик

Телеграм-бот отслеживает новые лоты на coins.ay.by, сохраняет историю и мгновенно уведомляет администраторов.

## Что умеет

- Периодически парсит список страниц и рассылает карточки с фото, ценой и ссылкой.
- Хранит состояние в SQLite (`data/items.db`), чтобы не дублировать уведомления.
- Позволяет управлять отслеживаемыми страницами и сортировками прямо из чата (`/tracking`).
- Даёт панель настроек: менять интервал проверок и добавлять админов (`/settings`).
- Логирует события в `logs/bot.log` и шлёт критические ошибки администраторам.

## Быстрый старт (Python 3.11+)

```bash
git clone <url>
cd LotSearch
python -m venv venv
```


```bash
pip install -r requirements.txt
```

Создайте `.env` из примера и заполните значения:

```bash
copy .env.example .env   # Windows
cp .env.example .env     # Linux/macOS
```

```env
BOT_TOKEN=xxx
ADMIN_CHAT_IDS=123456789
CHECK_INTERVAL_MINUTES=60
MONITOR_URLS=https://coins.ay.by/...
```

`MONITOR_URLS` используются как стартовый список: после первого запуска управлять страницами лучше через `/tracking`.

## Запуск

- `python main.py` — локально.
- `docker compose up --build` — в контейнере (маппит `./data` и `./logs`).

## Команды администратора

- `/start` — приветствие и список функций.
- `/status` — текущий интервал, активные страницы и админы.
- `/tracking` — меню управления отслеживаемыми страницами, сортировками и превью.
- `/settings` — панель изменения интервала и добавления администраторов.
- `/help` — краткая справка.

## Конфигурация

- Обязательные: `BOT_TOKEN`, `ADMIN_CHAT_IDS`, `CHECK_INTERVAL_MINUTES` (минуты), `MONITOR_URLS` (через запятую).
- Опциональные: `DB_PATH` (по умолчанию `data/items.db`), `LOG_DIR` (по умолчанию `logs`), `REQUEST_TIMEOUT`, `REQUEST_MAX_RETRIES`, `REQUEST_BACKOFF_FACTOR`.

## Тесты

- `pytest` — юнит-тесты.
- `pytest --cov` — покрытие.
- `pytest -m integration` — интеграционные проверки против реального сайта (нужен интернет).

## Лицензия

Проект предназначен для личного использования.
